@page "/account"
@using Susurri.Client.Models
@using System.Text.Json
@using System.Text
@using MudBlazor
@inject HttpClient Http

<h3>Account</h3>

<MudForm Model="SignUp" OnValidSubmit="@SubmitForm">
    <MudTextField Label="Username" @bind-Value="SignUp.Username" Id="Username" />
    <MudTextField Label="Password" @bind-Value="SignUp.Password" InputType="InputType.Password" Id="Password" />
    <MudButton Type="Submit" Color="Color.Primary">Sign Up</MudButton>
</MudForm>

@if (_showSuccessMessage)
{
    <MudAlert Severity="Severity.Success">You are successfully signed up and logged in!</MudAlert>
}

@code {
    private bool _showSuccessMessage = false;
    private SignUpViewModel SignUp { get; set; } = new SignUpViewModel();

    private async Task SubmitForm()
    {
        var signUpJson = JsonSerializer.Serialize(SignUp);
        var signUpContent = new StringContent(signUpJson, Encoding.UTF8, "application/json");

        var response = await Http.PostAsync("https://localhost:7200/account", signUpContent);

        if (response.IsSuccessStatusCode)
        {
            _showSuccessMessage = true;
        }
        else
        {
            var errorResponse = await response.Content.ReadAsStringAsync();
            Console.WriteLine($"Error: {errorResponse}");
        }
    }
}