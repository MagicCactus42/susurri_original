@page "/account"
@using Susurri.Client.Models
@using System.Text.Json
@using System.Text
@using MudBlazor
@inject HttpClient Http

<MudThemeProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudText Typo="Typo.h5" Class="ml-3">Susurri</MudText>
        <MudSpacer />
        <MudIconButton Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit" Edge="Edge.End" />
    </MudAppBar>
    <MudMainContent>
        <MudForm Model="SignUp" OnValidSubmit="@SubmitForm">
            <label for="Username">Username</label>
            <MudTextField @bind-Value="SignUp.Username" Id="Username" />
            
            <label for="Password">Password</label>
            <MudTextField @bind-Value="SignUp.Password" InputType="InputType.Password" Id="Password" />
            <MudButton Type="Submit" Color="Color.Primary">Sign Up</MudButton>
        </MudForm>
    </MudMainContent>
</MudLayout>

@if (_showSuccessMessage)
{
    <MudAlert Severity="Severity.Success">You are successfully signed up and logged in!</MudAlert>
}

@code {
    private bool _showSuccessMessage = false;
    private SignUpViewModel SignUp { get; set; } = new SignUpViewModel();

    private async Task SubmitForm()
    {
        var signUpJson = JsonSerializer.Serialize(SignUp);
        var signUpContent = new StringContent(signUpJson, Encoding.UTF8, "application/json");

        var response = await Http.PostAsync("https://localhost:7200/account", signUpContent);

        if (response.IsSuccessStatusCode)
        {
            _showSuccessMessage = true;
        }
        else
        {
            var errorResponse = await response.Content.ReadAsStringAsync();
            Console.WriteLine($"Error: {errorResponse}");
        }
    }
}